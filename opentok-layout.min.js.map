{"version":3,"sources":["webpack://initLayoutContainer/webpack/universalModuleDefinition","webpack://initLayoutContainer/webpack/bootstrap","webpack://initLayoutContainer/./src/index.js"],"names":["root","factory","exports","module","define","amd","self","this","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","css","el","propertyName","style","_typeof","currentValue","getComputedStyle","getPropertyValue","keys","forEach","positionElement","elem","x","y","width","height","animate","targetPosition","left","top","fixAspectRatio","sub","querySelector","oldWidth","$","stop","duration","easing","complete","classList","contains","add","getVideoRatio","video","videoHeight","videoWidth","getCSSNumber","prop","cssStr","parseInt","getHeight","heightStr","offsetHeight","getWidth","widthStr","offsetWidth","arrange","children","Width","Height","offsetLeft","offsetTop","fixedRatio","minRatio","maxRatio","dimensions","count","length","getBestDimensions","maxArea","targetCols","targetRows","targetHeight","targetWidth","tWidth","tHeight","tRatio","cols","rows","Math","ceil","floor","area","undefined","ratio","row","push","totalRowHeight","remainingShortRows","remainingHeightDiff","extraHeight","j","actualWidth","actualHeight","filterDisplayNone","element","layout","container","opts","id","getAttribute","random","toFixed","setAttribute","bigWidth","bigHeight","availableRatio","bigOffsetTop","bigOffsetLeft","bigOnes","Array","filter","querySelectorAll","bigClass","smallOnes","bigPercentage","bigFirst","bigFixedRatio","bigMinRatio","bigMaxRatio","custom","defaults","res","document","readyState","window","addEventListener"],"mappings":"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","file":"opentok-layout.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"initLayoutContainer\"] = factory();\n\telse\n\t\troot[\"initLayoutContainer\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/*!\n *  opentok-layout-js (http://github.com/aullman/opentok-layout-js)\n *\n *  Automatic layout of video elements (publisher and subscriber) minimising\n *  white-space for the OpenTok on WebRTC API.\n *\n *  @Author: Adam Ullman (http://github.com/aullman)\n *  @Copyright (c) 2014 Adam Ullman\n *  @License: Released under the MIT license (http://opensource.org/licenses/MIT)\n **/\n\n// in CommonJS context, this should be a `require()`d dependency.\n// in browser globals context, ...? (when using bower, there are dependencies that it has handled\n// for you, so these might be safe to assume)\n\n\nfunction css(el, propertyName, value) {\n  if (value) {\n    // We are setting one css property\n    el.style[propertyName] = value;\n  } else if (typeof propertyName === 'object') {\n    // We are setting several CSS properties at once\n    Object.keys(propertyName).forEach(function(key) {\n      css(el, key, propertyName[key]);\n    });\n  } else {\n    // We are getting the css property\n    var computedStyle = getComputedStyle(el);\n    var currentValue = computedStyle.getPropertyValue(propertyName);\n\n    if (currentValue === '') {\n      currentValue = el.style[propertyName];\n    }\n\n    return currentValue;\n  }\n}\n\nfunction height(el) {\n  if (el.offsetHeight > 0) {\n    return el.offsetHeight + 'px';\n  }\n  return css(el, 'height');\n}\n\nfunction width(el) {\n  if (el.offsetWidth > 0) {\n    return el.offsetWidth + 'px';\n  }\n  return css(el, 'width');\n}\n\nfunction defaults(custom, defaults) {\n  var res = {};\n  Object.keys(defaults).forEach(function(key) {\n    if (custom.hasOwnProperty(key)) {\n      res[key] = custom[key];\n    } else {\n      res[key] = defaults[key];\n    }\n  });\n  return res;\n}\n\nvar positionElement = function positionElement(elem, x, y, width, height, animate) {\n  var targetPosition = {\n    left: x + 'px',\n    top: y + 'px',\n    width: width + 'px',\n    height: height + 'px'\n  };\n\n  var fixAspectRatio = function() {\n    var sub = elem.querySelector('.OT_root');\n    if (sub) {\n      // If this is the parent of a subscriber or publisher then we need\n      // to force the mutation observer on the publisher or subscriber to\n      // trigger to get it to fix it's layout\n      var oldWidth = sub.style.width;\n      sub.style.width = width + 'px';\n      // sub.style.height = height + 'px';\n      sub.style.width = oldWidth || '';\n    }\n  };\n\n  if (animate && $) {\n    $(elem).stop();\n    $(elem).animate(targetPosition, animate.duration || 200, animate.easing || 'swing',\n      function() {\n        fixAspectRatio();\n        if (animate.complete) animate.complete.call(this);\n      });\n  } else {\n    css(elem, targetPosition);\n    if (!elem.classList.contains('ot-layout')) {\n      elem.classList.add('ot-layout');\n    }\n  }\n  fixAspectRatio();\n};\n\nvar getVideoRatio = function(elem) {\n  if (!elem) {\n    return 3 / 4;\n  }\n  var video = elem.querySelector('video');\n  if (video && video.videoHeight && video.videoWidth) {\n    return video.videoHeight / video.videoWidth;\n  } else if (elem.videoHeight && elem.videoWidth) {\n    return elem.videoHeight / elem.videoWidth;\n  }\n  return 3 / 4;\n}\n\nvar getCSSNumber = function(elem, prop) {\n  var cssStr = css(elem, prop);\n  return cssStr ? parseInt(cssStr, 10) : 0;\n};\n\n// Really cheap UUID function\nvar cheapUUID = function() {\n  return (Math.random() * 100000000).toFixed(0);\n};\n\nvar getHeight = function(elem) {\n  var heightStr = height(elem);\n  return heightStr ? parseInt(heightStr, 10) : 0;\n};\n\nvar getWidth = function(elem) {\n  var widthStr = width(elem);\n  return widthStr ? parseInt(widthStr, 10) : 0;\n};\n\nvar arrange = function arrange(children, Width, Height, offsetLeft, offsetTop, fixedRatio,\n  minRatio, maxRatio, animate) {\n  var count = children.length,\n    dimensions;\n\n  var getBestDimensions = function getBestDimensions(minRatio, maxRatio) {\n    var maxArea,\n      targetCols,\n      targetRows,\n      targetHeight,\n      targetWidth,\n      tWidth,\n      tHeight,\n      tRatio;\n\n    // Iterate through every possible combination of rows and columns\n    // and see which one has the least amount of whitespace\n    for (var i = 1; i <= count; i++) {\n      var cols = i;\n      var rows = Math.ceil(count / cols);\n\n      // Try taking up the whole height and width\n      tHeight = Math.floor(Height / rows);\n      tWidth = Math.floor(Width / cols);\n\n      tRatio = tHeight / tWidth;\n      if (tRatio > maxRatio) {\n        // We went over decrease the height\n        tRatio = maxRatio;\n        tHeight = tWidth * tRatio;\n      } else if (tRatio < minRatio) {\n        // We went under decrease the width\n        tRatio = minRatio;\n        tWidth = tHeight / tRatio;\n      }\n\n      var area = (tWidth * tHeight) * count;\n\n      // If this width and height takes up the most space then we're going with that\n      if (maxArea === undefined || (area > maxArea)) {\n        maxArea = area;\n        targetHeight = tHeight;\n        targetWidth = tWidth;\n        targetCols = cols;\n        targetRows = rows;\n      }\n    }\n    return {\n      maxArea: maxArea,\n      targetCols: targetCols,\n      targetRows: targetRows,\n      targetHeight: targetHeight,\n      targetWidth: targetWidth,\n      ratio: targetHeight / targetWidth\n    };\n  };\n\n  if (!fixedRatio) {\n    dimensions = getBestDimensions(minRatio, maxRatio);\n  } else {\n    // Use the ratio of the first video element we find to approximate\n    var ratio = getVideoRatio(children.length > 0 ? children[0] : null);\n    dimensions = getBestDimensions(ratio, ratio);\n  }\n\n  // Loop through each stream in the container and place it inside\n  var x = 0,\n    y = 0,\n    rows = [],\n    row;\n  // Iterate through the children and create an array with a new item for each row\n  // and calculate the width of each row so that we know if we go over the size and need\n  // to adjust\n  for (var i = 0; i < children.length; i++) {\n    if (i % dimensions.targetCols === 0) {\n      // This is a new row\n      row = {\n        children: [],\n        width: 0,\n        height: 0\n      };\n      rows.push(row);\n    }\n    var elem = children[i];\n    row.children.push(elem);\n    var targetWidth = dimensions.targetWidth;\n    var targetHeight = dimensions.targetHeight;\n    // If we're using a fixedRatio then we need to set the correct ratio for this element\n    if (fixedRatio) {\n      targetWidth = targetHeight / getVideoRatio(elem);\n    }\n    row.width += targetWidth;\n    row.height = targetHeight;\n  }\n  // Calculate total row height adjusting if we go too wide\n  var totalRowHeight = 0;\n  var remainingShortRows = 0;\n  for (i = 0; i < rows.length; i++) {\n    var row = rows[i];\n    if (row.width > Width) {\n      // Went over on the width, need to adjust the height proportionally\n      row.height = Math.floor(row.height * (Width / row.width));\n      row.width = Width;\n    } else if (row.width < Width) {\n      remainingShortRows += 1;\n    }\n    totalRowHeight += row.height;\n  }\n  if (totalRowHeight < Height && remainingShortRows > 0) {\n    // We can grow some of the rows, we're not taking up the whole height\n    var remainingHeightDiff = Height - totalRowHeight;\n    totalRowHeight = 0;\n    for (i = 0; i < rows.length; i++) {\n      var row = rows[i];\n      if (row.width < Width) {\n        // Evenly distribute the extra height between the short rows\n        var extraHeight = remainingHeightDiff / remainingShortRows;\n        if ((extraHeight / row.height) > ((Width - row.width) / row.width)) {\n          // We can't go that big or we'll go too wide\n          extraHeight = Math.floor(((Width - row.width) / row.width) * row.height);\n        }\n        row.width += Math.floor((extraHeight / row.height) * row.width);\n        row.height += extraHeight;\n        remainingHeightDiff -= extraHeight;\n        remainingShortRows -= 1;\n      }\n      totalRowHeight += row.height;\n    }\n  }\n  // vertical centering\n  y = ((Height - (totalRowHeight)) / 2);\n  // Iterate through each row and place each child\n  for (i = 0; i < rows.length; i++) {\n    var row = rows[i];\n    // center the row\n    var rowMarginLeft = ((Width - row.width) / 2);\n    x = rowMarginLeft;\n    for (var j = 0; j < row.children.length; j++) {\n      var elem = row.children[j];\n\n      var targetWidth = dimensions.targetWidth;\n      var targetHeight = row.height;\n      // If we're using a fixedRatio then we need to set the correct ratio for this element\n      if (fixedRatio) {\n        targetWidth = Math.floor(targetHeight / getVideoRatio(elem));\n      }\n      css(elem, 'position', 'absolute');\n      var actualWidth = targetWidth - getCSSNumber(elem, 'paddingLeft') -\n        getCSSNumber(elem, 'paddingRight') -\n        getCSSNumber(elem, 'marginLeft') -\n        getCSSNumber(elem, 'marginRight') -\n        getCSSNumber(elem, 'borderLeft') -\n        getCSSNumber(elem, 'borderRight');\n\n      var actualHeight = targetHeight - getCSSNumber(elem, 'paddingTop') -\n        getCSSNumber(elem, 'paddingBottom') -\n        getCSSNumber(elem, 'marginTop') -\n        getCSSNumber(elem, 'marginBottom') -\n        getCSSNumber(elem, 'borderTop') -\n        getCSSNumber(elem, 'borderBottom');\n\n      positionElement(elem, x + offsetLeft, y + offsetTop, actualWidth, actualHeight, animate);\n      x += targetWidth;\n    }\n    y += targetHeight;\n  }\n};\n\nvar filterDisplayNone = function(element) {\n  return css(element, 'display') !== 'none';\n};\n\nvar layout = function layout(container, opts) {\n  if (css(container, 'display') === 'none') {\n    return;\n  }\n  var id = container.getAttribute('id');\n  if (!id) {\n    id = 'OT_' + cheapUUID();\n    container.setAttribute('id', id);\n  }\n\n  var Height = getHeight(container) -\n    getCSSNumber(container, 'borderTop') -\n    getCSSNumber(container, 'borderBottom'),\n    Width = getWidth(container) -\n    getCSSNumber(container, 'borderLeft') -\n    getCSSNumber(container, 'borderRight'),\n    availableRatio = Height / Width,\n    offsetLeft = 0,\n    offsetTop = 0,\n    bigOffsetTop = 0,\n    bigOffsetLeft = 0,\n    bigOnes = Array.prototype.filter.call(\n      container.querySelectorAll('#' + id + '>.' + opts.bigClass),\n      filterDisplayNone),\n    smallOnes = Array.prototype.filter.call(\n      container.querySelectorAll('#' + id + '>*:not(.' + opts.bigClass + ')'),\n      filterDisplayNone);\n\n  if (bigOnes.length > 0 && smallOnes.length > 0) {\n    var bigWidth, bigHeight;\n\n    if (availableRatio > getVideoRatio(bigOnes[0])) {\n      // We are tall, going to take up the whole width and arrange small\n      // guys at the bottom\n      bigWidth = Width;\n      bigHeight = Math.floor(Height * opts.bigPercentage);\n      offsetTop = bigHeight;\n      bigOffsetTop = Height - offsetTop;\n    } else {\n      // We are wide, going to take up the whole height and arrange the small\n      // guys on the right\n      bigHeight = Height;\n      bigWidth = Math.floor(Width * opts.bigPercentage);\n      offsetLeft = bigWidth;\n      bigOffsetLeft = Width - offsetLeft;\n    }\n    if (opts.bigFirst) {\n      arrange(bigOnes, bigWidth, bigHeight, 0, 0, opts.bigFixedRatio, opts.bigMinRatio,\n        opts.bigMaxRatio, opts.animate);\n      arrange(smallOnes, Width - offsetLeft, Height - offsetTop, offsetLeft, offsetTop,\n        opts.fixedRatio, opts.minRatio, opts.maxRatio, opts.animate);\n    } else {\n      arrange(smallOnes, Width - offsetLeft, Height - offsetTop, 0, 0, opts.fixedRatio,\n        opts.minRatio, opts.maxRatio, opts.animate);\n      arrange(bigOnes, bigWidth, bigHeight, bigOffsetLeft, bigOffsetTop,\n        opts.bigFixedRatio, opts.bigMinRatio, opts.bigMaxRatio, opts.animate);\n    }\n  } else if (bigOnes.length > 0 && smallOnes.length === 0) {\n    // We only have one bigOne just center it\n    arrange(bigOnes, Width, Height, 0, 0, opts.bigFixedRatio, opts.bigMinRatio,\n      opts.bigMaxRatio, opts.animate);\n  } else {\n    arrange(smallOnes, Width - offsetLeft, Height - offsetTop, offsetLeft, offsetTop,\n      opts.fixedRatio, opts.minRatio, opts.maxRatio, opts.animate);\n  }\n};\n\nvar initLayoutContainer = function(container, opts) {\n  opts = defaults(opts || {}, {\n    maxRatio: 3 / 2,\n    minRatio: 9 / 16,\n    fixedRatio: false,\n    animate: false,\n    bigClass: 'OT_big',\n    bigPercentage: 0.8,\n    bigFixedRatio: false,\n    bigMaxRatio: 3 / 2,\n    bigMinRatio: 9 / 16,\n    bigFirst: true\n  });\n  container = typeof(container) === 'string' ? document.querySelector(container) : container;\n\n  if (document.readyState === 'complete') {\n    layout(container, opts);\n  } else {\n    window.addEventListener('load', function() {\n      layout(container, opts);\n    });\n  }\n\n  return {\n    layout: layout.bind(null, container, opts)\n  };\n};\n\nmodule.exports = initLayoutContainer;\n"],"sourceRoot":""}