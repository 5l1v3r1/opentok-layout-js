{"version":3,"sources":["webpack://initLayoutContainer/webpack/universalModuleDefinition","webpack://initLayoutContainer/webpack/bootstrap","webpack://initLayoutContainer/./src/index.js","webpack://initLayoutContainer/./src/getLayout.js","webpack://initLayoutContainer/./src/layout.js"],"names":["root","factory","exports","module","define","amd","self","this","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","getLayout","layout","container","opts","document","querySelector","HTMLElement","getBestDimensions","minRatio","maxRatio","Width","Height","count","maxArea","targetCols","targetRows","targetHeight","targetWidth","tWidth","tHeight","tRatio","cols","rows","Math","ceil","floor","area","undefined","ratio","ratios","_opts$maxRatio","_opts$minRatio","_opts$fixedRatio","fixedRatio","_opts$containerWidth","containerWidth","_opts$containerHeight","containerHeight","length","dimensions","x","y","row","boxes","width","height","push","totalRowHeight","remainingShortRows","remainingHeightDiff","extraHeight","j","aspectRatio","left","top","css","el","propertyName","style","NaN","_typeof","keys","forEach","currentValue","getComputedStyle","getPropertyValue","filterDisplayNone","element","getVideoRatio","elem","video","videoHeight","videoWidth","getCSSNumber","prop","cssStr","parseInt","getHeight","heightStr","offsetHeight","getWidth","widthStr","offsetWidth","arrange","children","offsetLeft","offsetTop","animate","map","child","box","idx","actualWidth","actualHeight","w","h","_this","targetPosition","fixAspectRatio","sub","oldWidth","$","stop","duration","easing","complete","classList","contains","add","positionElement","_opts$animate","_opts$bigClass","bigClass","_opts$bigPercentage","bigPercentage","_opts$bigFixedRatio","bigFixedRatio","_opts$bigMaxRatio","bigMaxRatio","_opts$bigMinRatio","bigMinRatio","_opts$bigFirst","bigFirst","id","getAttribute","random","toFixed","setAttribute","availableRatio","bigOffsetTop","bigOffsetLeft","bigOnes","Array","filter","querySelectorAll","smallOnes","bigWidth","bigHeight"],"mappings":"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","file":"opentok-layout.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"initLayoutContainer\"] = factory();\n\telse\n\t\troot[\"initLayoutContainer\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/*!\n *  opentok-layout-js (http://github.com/aullman/opentok-layout-js)\n *\n *  Automatic layout of video elements (publisher and subscriber) minimising\n *  white-space for the OpenTok on WebRTC API.\n *\n *  @Author: Adam Ullman (http://github.com/aullman)\n *  @Copyright (c) 2014 Adam Ullman\n *  @License: Released under the MIT license (http://opensource.org/licenses/MIT)\n * */\n\n// in CommonJS context, this should be a `require()`d dependency.\n// in browser globals context, ...? (when using bower, there are dependencies that it has handled\n// for you, so these might be safe to assume)\n\nconst getLayout = require('./getLayout');\nconst layout = require('./layout');\n\nmodule.exports = function initLayoutContainer(container, opts) {\n  container = typeof container === 'string' ? document.querySelector(container) : container;\n  if (!(typeof HTMLElement === 'undefined' || container instanceof HTMLElement) && !opts) {\n    // container is actually the options\n    opts = container;\n  } else if (!opts) {\n    opts = {};\n  }\n\n  return {\n    layout: layout.bind(this, container, opts),\n    getLayout: getLayout.bind(this, opts),\n  };\n};\n","const getBestDimensions = (minRatio, maxRatio, Width, Height, count) => {\n  let maxArea;\n  let targetCols;\n  let targetRows;\n  let targetHeight;\n  let targetWidth;\n  let tWidth;\n  let tHeight;\n  let tRatio;\n\n  // Iterate through every possible combination of rows and columns\n  // and see which one has the least amount of whitespace\n  for (let i = 1; i <= count; i += 1) {\n    const cols = i;\n    const rows = Math.ceil(count / cols);\n\n    // Try taking up the whole height and width\n    tHeight = Math.floor(Height / rows);\n    tWidth = Math.floor(Width / cols);\n\n    tRatio = tHeight / tWidth;\n    if (tRatio > maxRatio) {\n      // We went over decrease the height\n      tRatio = maxRatio;\n      tHeight = tWidth * tRatio;\n    } else if (tRatio < minRatio) {\n      // We went under decrease the width\n      tRatio = minRatio;\n      tWidth = tHeight / tRatio;\n    }\n\n    const area = (tWidth * tHeight) * count;\n\n    // If this width and height takes up the most space then we're going with that\n    if (maxArea === undefined || (area > maxArea)) {\n      maxArea = area;\n      targetHeight = tHeight;\n      targetWidth = tWidth;\n      targetCols = cols;\n      targetRows = rows;\n    }\n  }\n  return {\n    maxArea,\n    targetCols,\n    targetRows,\n    targetHeight,\n    targetWidth,\n    ratio: targetHeight / targetWidth,\n  };\n};\n\nmodule.exports = (opts, ratios) => {\n  const {\n    maxRatio = 3 / 2,\n    minRatio = 9 / 16,\n    fixedRatio = false,\n    containerWidth = 640,\n    containerHeight = 480,\n  } = opts;\n  const count = ratios.length;\n  let dimensions;\n\n  if (!fixedRatio) {\n    dimensions = getBestDimensions(minRatio, maxRatio, containerWidth, containerHeight, count);\n  } else {\n    // Use the ratio of the first video element we find to approximate\n    const ratio = ratios.length > 0 ? ratios[0] : null;\n    dimensions = getBestDimensions(ratio, ratio, containerWidth, containerHeight, count);\n  }\n\n  // Loop through each stream in the container and place it inside\n  let x = 0;\n  let y = 0;\n  const rows = [];\n  let row;\n  const boxes = [];\n  // Iterate through the children and create an array with a new item for each row\n  // and calculate the width of each row so that we know if we go over the size and need\n  // to adjust\n  for (let i = 0; i < ratios.length; i += 1) {\n    if (i % dimensions.targetCols === 0) {\n      // This is a new row\n      row = {\n        ratios: [],\n        width: 0,\n        height: 0,\n      };\n      rows.push(row);\n    }\n    const ratio = ratios[i];\n    row.ratios.push(ratio);\n    let targetWidth = dimensions.targetWidth;\n    const targetHeight = dimensions.targetHeight;\n    // If we're using a fixedRatio then we need to set the correct ratio for this element\n    if (fixedRatio) {\n      targetWidth = targetHeight / ratio;\n    }\n    row.width += targetWidth;\n    row.height = targetHeight;\n  }\n  // Calculate total row height adjusting if we go too wide\n  let totalRowHeight = 0;\n  let remainingShortRows = 0;\n  for (let i = 0; i < rows.length; i += 1) {\n    row = rows[i];\n    if (row.width > containerWidth) {\n      // Went over on the width, need to adjust the height proportionally\n      row.height = Math.floor(row.height * (containerWidth / row.width));\n      row.width = containerWidth;\n    } else if (row.width < containerWidth) {\n      remainingShortRows += 1;\n    }\n    totalRowHeight += row.height;\n  }\n  if (totalRowHeight < containerHeight && remainingShortRows > 0) {\n    // We can grow some of the rows, we're not taking up the whole height\n    let remainingHeightDiff = containerHeight - totalRowHeight;\n    totalRowHeight = 0;\n    for (let i = 0; i < rows.length; i += 1) {\n      row = rows[i];\n      if (row.width < containerWidth) {\n        // Evenly distribute the extra height between the short rows\n        let extraHeight = remainingHeightDiff / remainingShortRows;\n        if ((extraHeight / row.height) > ((containerWidth - row.width) / row.width)) {\n          // We can't go that big or we'll go too wide\n          extraHeight = Math.floor(((containerWidth - row.width) / row.width) * row.height);\n        }\n        row.width += Math.floor((extraHeight / row.height) * row.width);\n        row.height += extraHeight;\n        remainingHeightDiff -= extraHeight;\n        remainingShortRows -= 1;\n      }\n      totalRowHeight += row.height;\n    }\n  }\n  // vertical centering\n  y = ((containerHeight - (totalRowHeight)) / 2);\n  // Iterate through each row and place each child\n  for (let i = 0; i < rows.length; i += 1) {\n    row = rows[i];\n    // center the row\n    const rowMarginLeft = ((containerWidth - row.width) / 2);\n    x = rowMarginLeft;\n    let targetHeight;\n    for (let j = 0; j < row.ratios.length; j += 1) {\n      const ratio = row.ratios[j];\n\n      let targetWidth = dimensions.targetWidth;\n      targetHeight = row.height;\n      // If we're using a fixedRatio then we need to set the correct ratio for this element\n      if (fixedRatio) {\n        targetWidth = Math.floor(targetHeight / ratio);\n      }\n\n      boxes.push({\n        aspectRatio: ratio,\n        left: x,\n        top: y,\n        width: targetWidth,\n        height: targetHeight,\n      });\n      x += targetWidth;\n    }\n    y += targetHeight;\n  }\n  return boxes;\n};\n","const getLayout = require('./getLayout');\n\nfunction css(el, propertyName, value) {\n  if (value) {\n    // We are setting one css property\n    el.style[propertyName] = value;\n    return NaN;\n  }\n  if (typeof propertyName === 'object') {\n    // We are setting several CSS properties at once\n    Object.keys(propertyName).forEach((key) => {\n      css(el, key, propertyName[key]);\n    });\n    return NaN;\n  }\n  // We are getting the css property\n  const computedStyle = getComputedStyle(el);\n  let currentValue = computedStyle.getPropertyValue(propertyName);\n\n  if (currentValue === '') {\n    currentValue = el.style[propertyName];\n  }\n\n  return currentValue;\n}\n\nconst filterDisplayNone = element => css(element, 'display') !== 'none';\n\nfunction height(el) {\n  if (el.offsetHeight > 0) {\n    return `${el.offsetHeight}px`;\n  }\n  return css(el, 'height');\n}\n\nfunction width(el) {\n  if (el.offsetWidth > 0) {\n    return `${el.offsetWidth}px`;\n  }\n  return css(el, 'width');\n}\n\nconst positionElement = function positionElement(elem, x, y, w, h, animate) {\n  const targetPosition = {\n    left: `${x}px`,\n    top: `${y}px`,\n    width: `${w}px`,\n    height: `${h}px`,\n  };\n\n  const fixAspectRatio = function fixAspectRatio() {\n    const sub = elem.querySelector('.OT_root');\n    if (sub) {\n      // If this is the parent of a subscriber or publisher then we need\n      // to force the mutation observer on the publisher or subscriber to\n      // trigger to get it to fix it's layout\n      const oldWidth = sub.style.width;\n      sub.style.width = `${w}px`;\n      // sub.style.height = height + 'px';\n      sub.style.width = oldWidth || '';\n    }\n  };\n\n  if (animate && $) {\n    $(elem).stop();\n    $(elem).animate(targetPosition, animate.duration || 200, animate.easing || 'swing',\n      () => {\n        fixAspectRatio();\n        if (animate.complete) animate.complete.call(this);\n      });\n  } else {\n    css(elem, targetPosition);\n    if (!elem.classList.contains('ot-layout')) {\n      elem.classList.add('ot-layout');\n    }\n  }\n  fixAspectRatio();\n};\n\nconst getVideoRatio = function getVideoRatio(elem) {\n  if (!elem) {\n    return 3 / 4;\n  }\n  const video = elem.querySelector('video');\n  if (video && video.videoHeight && video.videoWidth) {\n    return video.videoHeight / video.videoWidth;\n  }\n  if (elem.videoHeight && elem.videoWidth) {\n    return elem.videoHeight / elem.videoWidth;\n  }\n  return 3 / 4;\n};\n\nconst getCSSNumber = function getCSSNumber(elem, prop) {\n  const cssStr = css(elem, prop);\n  return cssStr ? parseInt(cssStr, 10) : 0;\n};\n\n// Really cheap UUID function\nconst cheapUUID = function cheapUUID() {\n  return (Math.random() * 100000000).toFixed(0);\n};\n\nconst getHeight = function getHeight(elem) {\n  const heightStr = height(elem);\n  return heightStr ? parseInt(heightStr, 10) : 0;\n};\n\nconst getWidth = function getWidth(elem) {\n  const widthStr = width(elem);\n  return widthStr ? parseInt(widthStr, 10) : 0;\n};\n\nconst arrange = function arrange(children, containerWidth, containerHeight, offsetLeft, offsetTop,\n  fixedRatio, minRatio, maxRatio, animate) {\n  const boxes = getLayout({\n    containerWidth,\n    containerHeight,\n    minRatio,\n    maxRatio,\n    fixedRatio,\n  }, children.map(child => getVideoRatio(child)));\n\n  boxes.forEach((box, idx) => {\n    const elem = children[idx];\n    css(elem, 'position', 'absolute');\n    const actualWidth = box.width - getCSSNumber(elem, 'paddingLeft')\n      - getCSSNumber(elem, 'paddingRight')\n      - getCSSNumber(elem, 'marginLeft')\n      - getCSSNumber(elem, 'marginRight')\n      - getCSSNumber(elem, 'borderLeft')\n      - getCSSNumber(elem, 'borderRight');\n\n    const actualHeight = box.height - getCSSNumber(elem, 'paddingTop')\n      - getCSSNumber(elem, 'paddingBottom')\n      - getCSSNumber(elem, 'marginTop')\n      - getCSSNumber(elem, 'marginBottom')\n      - getCSSNumber(elem, 'borderTop')\n      - getCSSNumber(elem, 'borderBottom');\n\n    positionElement(elem, box.left + offsetLeft, box.top + offsetTop, actualWidth, actualHeight,\n      animate);\n  });\n};\n\nmodule.exports = (container, opts) => {\n  const {\n    maxRatio = 3 / 2,\n    minRatio = 9 / 16,\n    fixedRatio = false,\n    animate = false,\n    bigClass = 'OT_big',\n    bigPercentage = 0.8,\n    bigFixedRatio = false,\n    bigMaxRatio = 3 / 2,\n    bigMinRatio = 9 / 16,\n    bigFirst = true,\n  } = opts;\n  let {\n    containerWidth = 640,\n    containerHeight = 480,\n  } = opts;\n\n  if (css(container, 'display') === 'none') {\n    return;\n  }\n  let id = container.getAttribute('id');\n  if (!id) {\n    id = `OT_${cheapUUID()}`;\n    container.setAttribute('id', id);\n  }\n\n  containerHeight = getHeight(container)\n    - getCSSNumber(container, 'borderTop')\n    - getCSSNumber(container, 'borderBottom');\n  containerWidth = getWidth(container)\n    - getCSSNumber(container, 'borderLeft')\n    - getCSSNumber(container, 'borderRight');\n  const availableRatio = containerHeight / containerWidth;\n  let offsetLeft = 0;\n  let offsetTop = 0;\n  let bigOffsetTop = 0;\n  let bigOffsetLeft = 0;\n  const bigOnes = Array.prototype.filter.call(\n    container.querySelectorAll(`#${id}>.${bigClass}`),\n    filterDisplayNone\n  );\n  const smallOnes = Array.prototype.filter.call(\n    container.querySelectorAll(`#${id}>*:not(.${bigClass})`),\n    filterDisplayNone\n  );\n\n  if (bigOnes.length > 0 && smallOnes.length > 0) {\n    let bigWidth;\n    let\n      bigHeight;\n\n    if (availableRatio > getVideoRatio(bigOnes[0])) {\n      // We are tall, going to take up the whole width and arrange small\n      // guys at the bottom\n      bigWidth = containerWidth;\n      bigHeight = Math.floor(containerHeight * bigPercentage);\n      offsetTop = bigHeight;\n      bigOffsetTop = containerHeight - offsetTop;\n    } else {\n      // We are wide, going to take up the whole height and arrange the small\n      // guys on the right\n      bigHeight = containerHeight;\n      bigWidth = Math.floor(containerWidth * bigPercentage);\n      offsetLeft = bigWidth;\n      bigOffsetLeft = containerWidth - offsetLeft;\n    }\n    if (bigFirst) {\n      arrange(bigOnes, bigWidth, bigHeight, 0, 0, bigFixedRatio, bigMinRatio,\n        bigMaxRatio, animate);\n      arrange(smallOnes, containerWidth - offsetLeft, containerHeight - offsetTop, offsetLeft,\n        offsetTop, fixedRatio, minRatio, maxRatio, animate);\n    } else {\n      arrange(smallOnes, containerWidth - offsetLeft, containerHeight - offsetTop, 0, 0, fixedRatio,\n        minRatio, maxRatio, animate);\n      arrange(bigOnes, bigWidth, bigHeight, bigOffsetLeft, bigOffsetTop,\n        bigFixedRatio, bigMinRatio, bigMaxRatio, animate);\n    }\n  } else if (bigOnes.length > 0 && smallOnes.length === 0) {\n    // We only have one bigOne just center it\n    arrange(bigOnes, containerWidth, containerHeight, 0, 0, bigFixedRatio, bigMinRatio,\n      bigMaxRatio, animate);\n  } else {\n    arrange(smallOnes, containerWidth - offsetLeft, containerHeight - offsetTop, offsetLeft,\n      offsetTop, fixedRatio, minRatio, maxRatio, animate);\n  }\n};\n"],"sourceRoot":""}