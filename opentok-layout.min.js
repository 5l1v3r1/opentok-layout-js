/*!
 *  opentok-layout-js (http://github.com/aullman/opentok-layout-js)
 *
 *  Automatic layout of video elements (publisher and subscriber) minimising
 *  white-space for the OpenTok on WebRTC API.
 *
 *  @Author: Adam Ullman (http://github.com/aullman)
 *  @Copyright (c) 2014 Adam Ullman
 *  @License: Released under the MIT license (http://opensource.org/licenses/MIT)
**/
!function(t){function i(i,e,o){return OT?OT.$.css(i,e,o):t(i).css(e,o)}function e(i){return OT?OT.$.height(i):t(i).height()}function o(i){return OT?OT.$.width(i):t(i).width()}function r(i,e){return OT?OT.$.defaults(i,e):t.extend(i,e)}function a(i){return OT?OT.$(i):t(i)}var n=function(e,o,r,a,n,h){var d={left:o+"px",top:r+"px",width:a+"px",height:n+"px"},g=function(){var t=e.querySelector(".OT_root");if(t){var i=t.style.width;t.style.width=a+"px",t.style.width=i||""}};h&&t?(t(e).stop(),t(e).animate(d,h.duration||200,h.easing||"swing",function(){g(),h.complete&&h.complete.call(this)})):i(e,d),g()},h=function(t){if(!t)return.75;var i=t.querySelector("video");return i&&i.videoHeight&&i.videoWidth?i.videoHeight/i.videoWidth:t.videoHeight&&t.videoWidth?t.videoHeight/t.videoWidth:.75},d=function(t,e){var o=i(t,e);return o?parseInt(o,10):0},g=function(){return(1e8*Math.random()).toFixed(0)},l=function(t){var i=e(t);return i?parseInt(i,10):0},f=function(t){var i=o(t);return i?parseInt(i,10):0},u=function(t,e,o,r,a,g,l,f,u){var c,s=t.length,v=function(t,i){for(var r,a,n,h,d,g,l,f,u=1;s>=u;u++){var c=u,v=Math.ceil(s/c);l=Math.floor(o/v),g=Math.floor(e/c),f=l/g,f>i?(f=i,l=g*f):t>f&&(f=t,g=l/f);var p=g*l*s;(void 0===r||p>r)&&(r=p,h=l,d=g,a=c,n=v)}return{maxArea:r,targetCols:a,targetRows:n,targetHeight:h,targetWidth:d,ratio:h/d}};if(g){var p=h(t.length>0?t[0]:null);c=v(p,p)}else c=v(l,f);for(var b,m=0,w=0,R=[],x=0;x<t.length;x++){x%c.targetCols===0&&(b={children:[],width:0,height:0},R.push(b));var y=t[x];b.children.push(y);var M=c.targetWidth,T=c.targetHeight;g&&(M=T/h(y)),b.width+=M,b.height=T}var O=0,A=0;for(x=0;x<R.length;x++){var b=R[x];b.width>e?(b.height=Math.floor(b.height*(e/b.width)),b.width=e):b.width<e&&(A+=1),O+=b.height}if(o>O&&A>0){var C=o-O;for(O=0,x=0;x<R.length;x++){var b=R[x];if(b.width<e){var F=C/A;F/b.height>(e-b.width)/b.width&&(F=Math.floor((e-b.width)/b.width*b.height)),b.width+=Math.floor(F/b.height*b.width),b.height+=F,C-=F,A-=1}O+=b.height}}for(w=(o-O)/2,x=0;x<R.length;x++){var b=R[x],L=(e-b.width)/2;m=L;for(var W=0;W<b.children.length;W++){var y=b.children[W],M=c.targetWidth,T=b.height;g&&(M=Math.floor(T/h(y))),i(y,"position","absolute");var H=M-d(y,"paddingLeft")-d(y,"paddingRight")-d(y,"marginLeft")-d(y,"marginRight")-d(y,"borderLeft")-d(y,"borderRight"),$=T-d(y,"paddingTop")-d(y,"paddingBottom")-d(y,"marginTop")-d(y,"marginBottom")-d(y,"borderTop")-d(y,"borderBottom");n(y,m+r,w+a,H,$,u),m+=M}w+=T}},c=function(t){return"none"!==i(t,"display")},s=function(t,e){if("none"!==i(t,"display")){var o=t.getAttribute("id");o||(o="OT_"+g(),t.setAttribute("id",o));var r=l(t)-d(t,"borderTop")-d(t,"borderBottom"),a=f(t)-d(t,"borderLeft")-d(t,"borderRight"),n=r/a,s=0,v=0,p=0,b=0,m=Array.prototype.filter.call(t.querySelectorAll("#"+o+">."+e.bigClass),c),w=Array.prototype.filter.call(t.querySelectorAll("#"+o+">*:not(."+e.bigClass+")"),c);if(m.length>0&&w.length>0){var R,x;n>h(m[0])?(R=a,x=Math.floor(r*e.bigPercentage),v=x,p=r-v):(x=r,R=Math.floor(a*e.bigPercentage),s=R,b=a-s),e.bigFirst?(u(m,R,x,0,0,e.bigFixedRatio,e.bigMinRatio,e.bigMaxRatio,e.animate),u(w,a-s,r-v,s,v,e.fixedRatio,e.minRatio,e.maxRatio,e.animate)):(u(w,a-s,r-v,0,0,e.fixedRatio,e.minRatio,e.maxRatio,e.animate),u(m,R,x,b,p,e.bigFixedRatio,e.bigMinRatio,e.bigMaxRatio,e.animate))}else m.length>0&&0===w.length?u(m,a,r,0,0,e.bigFixedRatio,e.bigMinRatio,e.bigMaxRatio,e.animate):u(w,a-s,r-v,s,v,e.fixedRatio,e.minRatio,e.maxRatio,e.animate)}},v=function(t,i){return i=r(i||{},{maxRatio:1.5,minRatio:9/16,fixedRatio:!1,animate:!1,bigClass:"OT_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16,bigFirst:!0}),t="string"==typeof t?a(t):t,OT.onLoad(function(){s(t,i)}),{layout:s.bind(null,t,i)}};"undefined"==typeof module||"undefined"==typeof module.exports?window.initLayoutContainer=v:module.exports.initLayoutContainer=v}("undefined"!=typeof window&&window.hasOwnProperty("jQuery")?window.jQuery:void 0);