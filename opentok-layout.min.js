/*!
 *  opentok-layout-js (http://github.com/aullman/opentok-layout-js)
 *
 *  Automatic layout of video elements (publisher and subscriber) minimising
 *  white-space for the OpenTok on WebRTC API.
 *
 *  @Author: Adam Ullman (http://github.com/aullman)
 *  @Copyright (c) 2014 Adam Ullman
 *  @License: Released under the MIT license (http://opensource.org/licenses/MIT)
**/
("undefined"==typeof module||"undefined"==typeof module.exports)&&(exports=window),function(){var t=function(t,e){var i=t.style[e];return i?parseInt(i,10):0},e=function(){return(1e8*Math.random()).toFixed(0)},i=function(t,e){var i,r={};for(i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);for(i in e)e.hasOwnProperty(i)&&!r.hasOwnProperty(i)&&(r[i]=e[i]);return r},r=function(t){return"none"!==window.getComputedStyle(t).display},o=function(t){return t.clientHeight},n=function(t){return t.clientWidth},a=function(t,e,i,r,o){for(var n,a,l,g,d,s,f,y=1;i>=y;y++){var u=y,m=Math.ceil(i/u);f=Math.floor(o/m),s=Math.floor(r/u);var h=f/s;h>e?(h=e,f=s*h):t>h&&(h=t,s=f/h);var c=s*f*i;(void 0===n||c>n)&&(n=c,g=f,d=s,a=u,l=m)}return{maxArea:n,targetCols:a,targetRows:l,targetHeight:g,targetWidth:d}},l=function(t){return t&&t.videoHeight&&t.videoWidth?t.videoHeight/t.videoWidth:.75},g=function(e,i,r,o,n,g){var d,s=e.length;if(o){var f=e.length>0&&e[0].querySelector("video");n=g=l(f)}d=a(n,g,s,i,r);for(var y=0;y<e.length;y++){var u=e[y],m=d.targetWidth-t(u,"paddingLeft")-t(u,"paddingRight")-t(u,"marginLeft")-t(u,"marginRight")-t(u,"borderLeft")-t(u,"borderRight"),h=d.targetHeight-t(u,"paddingTop")-t(u,"paddingBottom")-t(u,"marginTop")-t(u,"marginBottom")-t(u,"borderTop")-t(u,"borderBottom");u.style.width=m+"px",u.style.height=h+"px"}},d=function(i,a){if(r(i)){var d=i.getAttribute("id");d||(d="OT_"+e(),i.setAttribute("id",d));var s,f=o(i)-t(i,"borderTop")-t(i,"borderBottom"),y=n(i)-t(i,"borderLeft")-t(i,"borderRight"),u=f/y,m=0,h=0,c=0,p=0,b=Array.prototype.filter.call(i.querySelectorAll("#"+d+">."+a.bigClass),r),x=Array.prototype.filter.call(i.querySelectorAll("#"+d+">*:not(."+a.bigClass+")"),r);if(b.length>0&&x.length>0){var v=b[0].querySelector("video");s=l(v);var R,w;u>s?(R=y,w=Math.min(Math.floor(f*a.bigPercentage),y*s),h=w,c=f-h):(i.style.flexDirection="column",w=f,R=Math.min(y*a.bigPercentage,Math.floor(w/s)),m=R,p=y-m);for(var M=0;M<b.length;M++)b[M].style.order=a.bigFirst?-1:1;g(x,y-m,f-h,a.fixedRatio,a.minRatio,a.maxRatio,a.animate),g(b,R,w,a.bigFixedRatio,a.bigMinRatio,a.bigMaxRatio,a.animate)}else b.length>0&&0===x.length?g(b,y,f,a.bigFixedRatio,a.bigMinRatio,a.bigMaxRatio,a.animate):g(x,y-m,f-h,a.fixedRatio,a.minRatio,a.maxRatio,a.animate)}};exports.initLayoutContainer=function(t,e){return e=i(e||{},{maxRatio:1.5,minRatio:9/16,fixedRatio:!1,animate:!1,bigClass:"OT_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16,bigFirst:!0}),t="string"==typeof t?document.querySelector(t):t,t.style.display="flex",t.style.flexDirection="row",t.style.flexWrap="wrap",t.style.justifyContent="center",t.style.alignItems="center",t.style.alignContent="center",t.style.msFlexDirection="row",t.style.msFlexWrap="wrap",t.style.msJustifyContent="center",t.style.msAlignItems="center",t.style.msAlignContent="center",window.getComputedStyle(t).hasOwnProperty("msAlignContent")&&(t.style.display="-ms-flexbox"),d(t,e),{layout:d.bind(null,t,e)}}}();