/*!
 *  opentok-layout-js (http://github.com/aullman/opentok-layout-js)
 *  
 *  Automatic layout of video elements (publisher and subscriber) minimising 
 *  white-space for the OpenTok on WebRTC API.
 *
 *  @Author: Adam Ullman (http://github.com/aullman)
 *  @Copyright (c) 2014 Adam Ullman
 *  @License: Released under the MIT license (http://opensource.org/licenses/MIT)
**/
!function(){var t=function(t,i,e,a,o,r){var n={left:i+"px",top:e+"px",width:a+"px",height:o+"px"},g=function(){var i=t.querySelector(".OT_root");if(i){var e=i.style.width;i.style.width=a+"px",i.style.width=e||""}};r&&$?($(t).stop(),$(t).animate(n,r.duration||200,r.easing||"swing",function(){g(),r.complete&&r.complete.call(this)})):OT.$.css(t,n),g()},i=function(t,i){var e=OT.$.css(t,i);return e?parseInt(e,10):0},e=function(t){var i=OT.$.height(t);return i?parseInt(i,10):0},a=function(t){var i=OT.$.width(t);return i?parseInt(i,10):0},o=function(e,a,o,r,n,g,d,l,h){var s,f=e.length,u=o/a,b=function(t){for(var i,e,r,n,g,d,l,h=1;f>=h;h++){var s=h,b=Math.ceil(f/s);b/s*t>u?(l=Math.floor(o/b),d=Math.floor(l/t)):(d=Math.floor(a/s),l=Math.floor(d*t));var c=d*l*f;(void 0===i||c>i)&&(i=c,n=l,g=d,e=s,r=b)}return{maxArea:i,targetCols:e,targetRows:r,targetHeight:n,targetWidth:g,ratio:t}};if(g){var c=e[0].querySelector("video");s=b(c?c.videoHeight/c.videoWidth:.75)}else{var R,v=l>d?(l-d)/20:0;for($=d;l>=$;$=OT.$.roundFloat($+v,5))R=b($),(!s||R.maxArea>s.maxArea)&&(s=R)}for(var m=s.targetRows*s.targetCols-f,p=m*s.targetWidth/2,T=(s.targetRows-1)*s.targetCols,x=(o-s.targetRows*s.targetHeight)/2,M=(a-s.targetCols*s.targetWidth)/2,y=0,O=0,$=0;$<e.length;$++){var w=e[$];$%s.targetCols===0?(y=M,$==T&&(y+=p),O+=0===$?x:s.targetHeight):y+=s.targetWidth,OT.$.css(w,"position","absolute");var C=s.targetWidth-i(w,"paddingLeft")-i(w,"paddingRight")-i(w,"marginLeft")-i(w,"marginRight")-i(w,"borderLeft")-i(w,"borderRight"),A=s.targetHeight-i(w,"paddingTop")-i(w,"paddingBottom")-i(w,"marginTop")-i(w,"marginBottom")-i(w,"borderTop")-i(w,"borderBottom");t(w,y+r,O+n,C,A,h)}},r=function(t,r){if("none"!==OT.$.css(t,"display")){var n=t.getAttribute("id");n||(n="OT_"+TB.$.uuid(),t.setAttribute("id",n));var g=e(t)-i(t,"borderTop")-i(t,"borderBottom"),d=a(t)-i(t,"borderLeft")-i(t,"borderRight"),l=g/d,h=0,s=0,f=t.querySelectorAll("#"+n+">."+r.bigClass),u=t.querySelectorAll("#"+n+">*:not(."+r.bigClass+")");if(f.length>0&&u.length>0){var b=f[0].querySelector("video");bigRatio=b?b.videoHeight/b.videoWidth:.75;var c,R;l>bigRatio?(c=d,R=Math.min(Math.floor(g*r.bigPercentage),d*bigRatio),s=R):(R=g,c=Math.min(d*r.bigPercentage,Math.floor(R/bigRatio)),h=c),o(f,c,R,0,0,r.bigFixedRatio,r.bigMinRatio,r.bigMaxRatio,r.animate)}else f.length>0&&0===u.length&&o(f,d,g,0,0,r.bigFixedRatio,r.bigMinRatio,r.bigMaxRatio,r.animate);o(u,d-h,g-s,h,s,r.fixedRatio,r.minRatio,r.maxRatio,r.animate)}};if(!TB)throw new Error("You must include the OpenTok for WebRTC JS API before the layout-container library");TB.initLayoutContainer=function(t,i){return i=OT.$.defaults(i||{},{maxRatio:1.5,minRatio:9/16,fixedRatio:!1,animate:!1,bigClass:"OT_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16}),t="string"==typeof t?OT.$(t):t,OT.onLoad(function(){r(t,i)}),{layout:r.bind(null,t,i)}}}();